<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Digital - Almac√©n</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="pagina-ingreso">

  <div class="nav">
    <h1>üìì Agenda Almac√©n</h1>
  </div>

  <main class="contenedor">
    <h2 class="titulo">Agregar nueva tarea</h2>

    <form id="formTarea" class="formulario">
      <label>T√≠tulo de la tarea</label>
      <input type="text" id="tarea" placeholder="Ejemplo: Enviar informe mensual" required>

      <div class="fila">
        <div class="columna">
          <label>Frecuencia</label>
          <select id="frecuencia">
            <option>Diaria</option>
            <option>Semanal</option>
            <option>Mensual</option>
          </select>
        </div>
        <div class="columna">
          <label>Fecha l√≠mite</label>
          <input type="date" id="fechaLimite" required>
        </div>
      </div>

      <label>Estado</label>
      <select id="estado">
        <option>Pendiente</option>
        <option>En progreso</option>
        <option>Completada</option>
      </select>

      <label>N√∫mero de WhatsApp (opcional)</label>
      <input type="text" id="numero" placeholder="+57...">

      <button type="submit" class="btn-principal">Guardar tarea</button>
    </form>

    <h2 class="titulo subtitulo">Mis Tareas</h2>
    <div id="listaTareas" class="lista-tareas"></div>
  </main>

  <footer class="footer">
    <p>Hecho con precisi√≥n y estilo ‚ú®</p>
  </footer>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxDJNf0cGtRDdX4V9Ph4IRCLnPhknyvX7SNmBLoqCyqY_O-m31_moHwsi0Rx2XAbpjo3A/exec"; 
    const form = document.getElementById('formTarea');
    const lista = document.getElementById('listaTareas');

    // Guardar nueva tarea
    form.addEventListener('submit', e => {
      e.preventDefault();

      const datos = {
        tarea: document.getElementById('tarea').value,
        frecuencia: document.getElementById('frecuencia').value,
        fechaLimite: document.getElementById('fechaLimite').value,
        estado: document.getElementById('estado').value,
        numero: document.getElementById('numero').value
      };

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(datos)
      })
      .then(res => res.json())
      .then(data => {
        if (data.resultado === "ok") {
          alert('‚úÖ Tarea guardada correctamente');
          form.reset();
          cargarTareas(); // Mostrar actualizadas
        } else {
          alert('‚ö†Ô∏è Error: ' + data.mensaje);
        }
      })
      .catch(err => alert('‚ùå Error de conexi√≥n: ' + err.message));
    });

    // Obtener tareas desde Google Sheets
    async function cargarTareas() {
      lista.innerHTML = `<p class="vacio">‚è≥ Cargando tareas...</p>`;
      try {
        const res = await fetch(scriptURL + '?read=true');
        const data = await res.json();

        if (!data || data.length === 0) {
          lista.innerHTML = `<p class='vacio'>No hay tareas a√∫n.</p>`;
          return;
        }

        lista.innerHTML = '';
        data.forEach((t, i) => {
          const card = document.createElement('div');
          card.classList.add('tarjeta');
          card.innerHTML = `
            <div class="tarjeta-info">
              <h2>${t[1]}</h2>
              <p><span>Frecuencia:</span> ${t[2]}</p>
              <p><span>Fecha l√≠mite:</span> ${t[3]}</p>
              <p><span>Estado:</span> ${t[4]}</p>
              ${t[5] ? `<p><span>WhatsApp:</span> ${t[5]}</p>` : ''}
            </div>
          `;
          lista.appendChild(card);
        });
      } catch (err) {
        lista.innerHTML = `<p class="vacio">‚ùå No se pudieron cargar las tareas.</p>`;
        console.error(err);
      }
    }

    cargarTareas();
  </script>

</body>
</html>



